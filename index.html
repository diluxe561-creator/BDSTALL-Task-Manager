<!DOCTYPE html>
<html lang="en" class="antialiased">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BDSTALL- Task Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#eff6ff',
                            100: '#dbeafe',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                        }
                    },
                    animation: {
                        'slide-in': 'slideIn 0.3s ease-out',
                        'fade-in': 'fadeIn 0.2s ease-out',
                        'bounce-subtle': 'bounceSubtle 0.3s ease-in-out',
                    },
                    keyframes: {
                        slideIn: {
                            '0%': { transform: 'translateX(-100%)', opacity: '0' },
                            '100%': { transform: 'translateX(0)', opacity: '1' },
                        },
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'scale(0.95)' },
                            '100%': { opacity: '1', transform: 'scale(1)' },
                        },
                        bounceSubtle: {
                            '0%, 100%': { transform: 'scale(1)' },
                            '50%': { transform: 'scale(1.02)' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * {
            font-family: 'Inter', sans-serif;
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
        
        .dark .glass-effect {
            background: rgba(17, 24, 39, 0.7);
        }
        
        .task-card {
            transition: all 0.2s ease;
            cursor: grab;
        }
        
        .task-card:active {
            cursor: grabbing;
        }
        
        .task-card.dragging {
            opacity: 0.5;
            transform: rotate(2deg);
        }
        
        .column-drop-zone {
            transition: all 0.2s ease;
            min-height: 100px;
        }
        
        .column-drop-zone.drag-over {
            background-color: rgba(59, 130, 246, 0.1);
            border: 2px dashed #3b82f6;
            border-radius: 0.5rem;
        }
        
        .dark .column-drop-zone.drag-over {
            background-color: rgba(59, 130, 246, 0.2);
        }
        
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background-color: rgba(156, 163, 175, 0.5);
            border-radius: 20px;
        }
        
        .dark .custom-scrollbar::-webkit-scrollbar-thumb {
            background-color: rgba(75, 85, 99, 0.5);
        }
        
        .priority-high { border-left: 4px solid #ef4444; }
        .priority-medium { border-left: 4px solid #f59e0b; }
        .priority-low { border-left: 4px solid #10b981; }
        
        .sidebar-item {
            transition: all 0.2s ease;
        }
        
        .sidebar-item:hover {
            transform: translateX(4px);
        }
        
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors duration-300">
    <div id="app" class="h-screen flex overflow-hidden">
        <!-- Sidebar -->
        <aside id="sidebar" class="w-64 bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700 flex flex-col transition-all duration-300 transform -translate-x-full md:translate-x-0 absolute md:relative z-30 h-full">
            <div class="p-6 border-b border-gray-200 dark:border-gray-700">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl flex items-center justify-center text-white font-bold text-xl shadow-lg">
                        K
                    </div>
                    <div>
                        <h1 class="font-bold text-xl tracking-tight">BDSTALL</h1>
                        <p class="text-xs text-gray-500 dark:text-gray-400">Task Manager</p>
                    </div>
                </div>
            </div>
            
            <nav class="flex-1 overflow-y-auto p-4 space-y-2 custom-scrollbar">
                <div class="mb-6">
                    <h3 class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-3 px-2">Boards</h3>
                    <div id="boards-list" class="space-y-1">
                        <!-- Boards injected here -->
                    </div>
                </div>
                
                <div class="mb-6">
                    <h3 class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-3 px-2">Views</h3>
                    <button onclick="app.switchView('board')" class="sidebar-item w-full flex items-center gap-3 px-3 py-2 rounded-lg text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17V7m0 10a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h2a2 2 0 012 2m0 10a2 2 0 002 2h2a2 2 0 002-2M9 7a2 2 0 012-2h2a2 2 0 012 2m0 10V7m0 10a2 2 0 002 2h2a2 2 0 002-2V7a2 2 0 00-2-2h-2a2 2 0 00-2 2"></path></svg>
                        Board View
                    </button>
                    <button onclick="app.switchView('list')" class="sidebar-item w-full flex items-center gap-3 px-3 py-2 rounded-lg text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16"></path></svg>
                        List View
                    </button>
                </div>
            </nav>
            
            <div class="p-4 border-t border-gray-200 dark:border-gray-700 space-y-2">
                <button onclick="app.toggleTheme()" class="w-full flex items-center gap-3 px-3 py-2 rounded-lg text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                    <svg id="theme-icon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>
                    <span id="theme-text">Dark Mode</span>
                </button>
            </div>
        </aside>
        
        <!-- Mobile Sidebar Overlay -->
        <div id="sidebar-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-20 hidden md:hidden" onclick="app.toggleSidebar()"></div>
        
        <!-- Main Content -->
        <main class="flex-1 flex flex-col min-w-0">
            <!-- Header -->
            <header class="glass-effect border-b border-gray-200 dark:border-gray-700 px-6 py-4 flex items-center justify-between sticky top-0 z-10">
                <div class="flex items-center gap-4">
                    <button onclick="app.toggleSidebar()" class="md:hidden p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
                    </button>
                    <div>
                        <h2 id="current-board-name" class="text-2xl font-bold text-gray-900 dark:text-white">Select a Board</h2>
                        <p id="current-board-desc" class="text-sm text-gray-500 dark:text-gray-400 hidden sm:block">Manage your tasks efficiently</p>
                    </div>
                </div>
                
                <div class="flex items-center gap-3">
                    <div class="hidden sm:flex items-center gap-2 bg-gray-100 dark:bg-gray-800 rounded-lg p-1">
                        <button onclick="app.switchView('board')" id="view-board-btn" class="px-3 py-1.5 rounded-md text-sm font-medium transition-all bg-white dark:bg-gray-700 shadow-sm">
                            Board
                        </button>
                        <button onclick="app.switchView('list')" id="view-list-btn" class="px-3 py-1.5 rounded-md text-sm font-medium transition-all text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white">
                            List
                        </button>
                    </div>
                    
                    <button onclick="app.openTaskModal()" class="flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-all transform hover:scale-105 shadow-lg shadow-blue-500/30">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                        <span class="hidden sm:inline">New Task</span>
                    </button>
                </div>
            </header>
            
            <!-- Content Area -->
            <div id="content-area" class="flex-1 overflow-x-auto overflow-y-hidden custom-scrollbar p-6">
                <!-- Dynamic content injected here -->
            </div>
        </main>
    </div>
    
    <!-- Task Modal -->
    <div id="task-modal" class="fixed inset-0 z-50 hidden">
        <div class="modal-backdrop absolute inset-0" onclick="app.closeTaskModal()"></div>
        <div class="absolute inset-0 flex items-center justify-center p-4 pointer-events-none">
            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-full max-w-lg pointer-events-auto transform transition-all scale-95 opacity-0" id="task-modal-content">
                <div class="p-6 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between">
                    <h3 id="modal-title" class="text-xl font-bold">New Task</h3>
                    <button onclick="app.closeTaskModal()" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                    </button>
                </div>
                <form id="task-form" onsubmit="app.handleTaskSubmit(event)" class="p-6 space-y-4">
                    <input type="hidden" id="task-id">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Title</label>
                        <input type="text" id="task-title" required class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="Enter task title">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Description</label>
                        <textarea id="task-desc" rows="3" class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all resize-none" placeholder="Add description..."></textarea>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Priority</label>
                            <select id="task-priority" class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                                <option value="low">Low</option>
                                <option value="medium">Medium</option>
                                <option value="high">High</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Status</label>
                            <select id="task-status" class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                                <option value="todo">To Do</option>
                                <option value="inprogress">In Progress</option>
                                <option value="done">Done</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Tags (comma separated)</label>
                        <input type="text" id="task-tags" class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="design, urgent, review">
                    </div>
                    <div class="flex gap-3 pt-4">
                        <button type="button" id="delete-task-btn" onclick="app.deleteCurrentTask()" class="hidden flex-1 px-4 py-2 border border-red-300 text-red-600 rounded-lg hover:bg-red-50 dark:hover:bg-red-900/20 font-medium transition-colors">
                            Delete
                        </button>
                        <button type="submit" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-all transform hover:scale-[1.02]">
                            Save Task
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Board Modal -->
    <div id="board-modal" class="fixed inset-0 z-50 hidden">
        <div class="modal-backdrop absolute inset-0" onclick="app.closeBoardModal()"></div>
        <div class="absolute inset-0 flex items-center justify-center p-4 pointer-events-none">
            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-full max-w-md pointer-events-auto transform transition-all scale-95 opacity-0" id="board-modal-content">
                <div class="p-6 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between">
                    <h3 class="text-xl font-bold">Create New Board</h3>
                    <button onclick="app.closeBoardModal()" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                    </button>
                </div>
                <form onsubmit="app.handleBoardSubmit(event)" class="p-6 space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Board Name</label>
                        <input type="text" id="board-name" required class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="e.g., Marketing Campaign">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Description</label>
                        <textarea id="board-desc" rows="2" class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all resize-none" placeholder="Brief description..."></textarea>
                    </div>
                    <div class="flex gap-3 pt-4">
                        <button type="button" onclick="app.closeBoardModal()" class="flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 font-medium transition-colors">
                            Cancel
                        </button>
                        <button type="submit" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-all transform hover:scale-[1.02]">
                            Create Board
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-6 right-6 transform translate-y-20 opacity-0 transition-all duration-300 z-50">
        <div class="bg-gray-900 dark:bg-white text-white dark:text-gray-900 px-6 py-3 rounded-lg shadow-2xl flex items-center gap-3">
            <svg class="w-5 h-5 text-green-400 dark:text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
            <span id="toast-message" class="font-medium">Action completed</span>
        </div>
    </div>

    <script>
        // Kanban Application Module
        const KanbanApp = (function() {
            // State Management
            const state = {
                boards: [],
                currentBoardId: null,
                currentView: 'board',
                draggedTask: null,
                darkMode: false
            };

            // Mock API / Local Storage Service
            const StorageService = {
                save(data) {
                    localStorage.setItem('kanban_data', JSON.stringify(data));
                },
                load() {
                    const data = localStorage.getItem('kanban_data');
                    return data ? JSON.parse(data) : null;
                },
                init() {
                    const saved = this.load();
                    if (saved) {
                        state.boards = saved.boards || [];
                        state.darkMode = saved.darkMode || false;
                    } else {
                        // Initialize with sample data
                        state.boards = [
                            {
                                id: 'board-1',
                                name: 'Product Development',
                                description: 'Main product roadmap and features',
                                createdAt: new Date().toISOString(),
                                tasks: [
                                    { id: 'task-1', title: 'Design System Update', description: 'Update color palette and typography', priority: 'high', status: 'inprogress', tags: ['design', 'urgent'], createdAt: new Date().toISOString() },
                                    { id: 'task-2', title: 'API Integration', description: 'Connect frontend with backend services', priority: 'high', status: 'todo', tags: ['dev', 'backend'], createdAt: new Date().toISOString() },
                                    { id: 'task-3', title: 'User Testing', description: 'Conduct usability tests with 5 users', priority: 'medium', status: 'done', tags: ['research'], createdAt: new Date().toISOString() }
                                ]
                            },
                            {
                                id: 'board-2',
                                name: 'Marketing Campaign',
                                description: 'Q1 marketing initiatives',
                                createdAt: new Date().toISOString(),
                                tasks: [
                                    { id: 'task-4', title: 'Social Media Strategy', description: 'Plan content calendar for Q1', priority: 'medium', status: 'todo', tags: ['social', 'content'], createdAt: new Date().toISOString() }
                                ]
                            }
                        ];
                        state.currentBoardId = 'board-1';
                        this.save(state);
                    }
                }
            };

            // DOM Elements
            const elements = {
                sidebar: document.getElementById('sidebar'),
                sidebarOverlay: document.getElementById('sidebar-overlay'),
                boardsList: document.getElementById('boards-list'),
                contentArea: document.getElementById('content-area'),
                currentBoardName: document.getElementById('current-board-name'),
                currentBoardDesc: document.getElementById('current-board-desc'),
                taskModal: document.getElementById('task-modal'),
                taskModalContent: document.getElementById('task-modal-content'),
                boardModal: document.getElementById('board-modal'),
                boardModalContent: document.getElementById('board-modal-content'),
                toast: document.getElementById('toast'),
                toastMessage: document.getElementById('toast-message'),
                viewBoardBtn: document.getElementById('view-board-btn'),
                viewListBtn: document.getElementById('view-list-btn')
            };

            // Utility Functions
            const utils = {
                generateId: () => Math.random().toString(36).substr(2, 9),
                formatDate: (date) => new Date(date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' }),
                showToast: (message) => {
                    elements.toastMessage.textContent = message;
                    elements.toast.classList.remove('translate-y-20', 'opacity-0');
                    setTimeout(() => {
                        elements.toast.classList.add('translate-y-20', 'opacity-0');
                    }, 3000);
                },
                getPriorityColor: (priority) => {
                    const colors = {
                        high: 'bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400',
                        medium: 'bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400',
                        low: 'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400'
                    };
                    return colors[priority] || colors.low;
                }
            };

            // Render Functions
            const render = {
                boardsList() {
                    const html = state.boards.map(board => `
                        <div class="group flex items-center justify-between px-3 py-2 rounded-lg cursor-pointer transition-all ${state.currentBoardId === board.id ? 'bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400' : 'hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300'}" 
                             onclick="app.selectBoard('${board.id}')">
                            <div class="flex items-center gap-3 flex-1 min-w-0">
                                <div class="w-2 h-2 rounded-full ${state.currentBoardId === board.id ? 'bg-blue-500' : 'bg-gray-300 dark:bg-gray-600'}"></div>
                                <span class="font-medium truncate text-sm">${board.name}</span>
                            </div>
                            <button onclick="event.stopPropagation(); app.deleteBoard('${board.id}')" 
                                    class="opacity-0 group-hover:opacity-100 p-1 hover:bg-red-100 dark:hover:bg-red-900/30 rounded transition-all text-red-500">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                            </button>
                        </div>
                    `).join('');
                    
                    elements.boardsList.innerHTML = html + `
                        <button onclick="app.openBoardModal()" class="w-full mt-2 flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-colors border border-dashed border-blue-300 dark:border-blue-700">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                            Create Board
                        </button>
                    `;
                },

                boardView() {
                    const board = state.boards.find(b => b.id === state.currentBoardId);
                    if (!board) return;

                    elements.currentBoardName.textContent = board.name;
                    elements.currentBoardDesc.textContent = board.description;

                    const columns = [
                        { id: 'todo', title: 'To Do', color: 'bg-gray-500', bg: 'bg-gray-50 dark:bg-gray-800/50' },
                        { id: 'inprogress', title: 'In Progress', color: 'bg-blue-500', bg: 'bg-blue-50/50 dark:bg-blue-900/20' },
                        { id: 'done', title: 'Done', color: 'bg-green-500', bg: 'bg-green-50/50 dark:bg-green-900/20' }
                    ];

                    elements.contentArea.innerHTML = `
                        <div class="flex gap-6 h-full min-w-max pb-4">
                            ${columns.map(col => {
                                const tasks = board.tasks.filter(t => t.status === col.id);
                                return `
                                    <div class="w-80 flex flex-col">
                                        <div class="flex items-center justify-between mb-4 px-1">
                                            <div class="flex items-center gap-2">
                                                <div class="w-3 h-3 rounded-full ${col.color}"></div>
                                                <h3 class="font-semibold text-gray-700 dark:text-gray-300">${col.title}</h3>
                                                <span class="bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-400 text-xs font-medium px-2 py-0.5 rounded-full">${tasks.length}</span>
                                            </div>
                                            <button onclick="app.openTaskModal(null, '${col.id}')" class="p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded transition-colors">
                                                <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                                            </button>
                                        </div>
                                        <div class="${col.bg} rounded-xl p-3 flex-1 column-drop-zone space-y-3" 
                                             data-status="${col.id}"
                                             ondragover="app.handleDragOver(event)" 
                                             ondrop="app.handleDrop(event)"
                                             ondragleave="app.handleDragLeave(event)">
                                            ${tasks.map(task => this.taskCard(task)).join('')}
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    `;
                },

                listView() {
                    const board = state.boards.find(b => b.id === state.currentBoardId);
                    if (!board) return;

                    elements.currentBoardName.textContent = board.name;
                    
                    const sortedTasks = [...board.tasks].sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));

                    elements.contentArea.innerHTML = `
                        <div class="max-w-4xl mx-auto space-y-3 overflow-y-auto h-full custom-scrollbar pr-2">
                            ${sortedTasks.map(task => `
                                <div class="bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm border border-gray-200 dark:border-gray-700 hover:shadow-md transition-all cursor-pointer group"
                                     onclick="app.openTaskModal('${task.id}')">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center gap-4 flex-1">
                                            <div class="w-1 h-12 rounded-full ${task.priority === 'high' ? 'bg-red-500' : task.priority === 'medium' ? 'bg-amber-500' : 'bg-green-500'}"></div>
                                            <div class="flex-1">
                                                <h4 class="font-semibold text-gray-900 dark:text-white mb-1">${task.title}</h4>
                                                <p class="text-sm text-gray-500 dark:text-gray-400 line-clamp-1">${task.description || 'No description'}</p>
                                                <div class="flex items-center gap-2 mt-2">
                                                    ${task.tags.map(tag => `<span class="text-xs bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 px-2 py-0.5 rounded">#${tag}</span>`).join('')}
                                                </div>
                                            </div>
                                        </div>
                                        <div class="flex items-center gap-4">
                                            <span class="px-3 py-1 rounded-full text-xs font-medium ${utils.getPriorityColor(task.priority)} capitalize">${task.priority}</span>
                                            <span class="text-sm text-gray-500 dark:text-gray-400">${utils.formatDate(task.createdAt)}</span>
                                            <button onclick="event.stopPropagation(); app.deleteTask('${task.id}')" class="opacity-0 group-hover:opacity-100 p-2 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-all">
                                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                            ${board.tasks.length === 0 ? '<div class="text-center py-12 text-gray-500 dark:text-gray-400">No tasks yet. Create your first task!</div>' : ''}
                        </div>
                    `;
                },

                taskCard(task) {
                    return `
                        <div class="task-card bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 hover:shadow-md priority-${task.priority}"
                             draggable="true"
                             ondragstart="app.handleDragStart(event, '${task.id}')"
                             ondragend="app.handleDragEnd(event)"
                             onclick="app.openTaskModal('${task.id}')">
                            <div class="flex items-start justify-between mb-2">
                                <h4 class="font-medium text-gray-900 dark:text-white text-sm line-clamp-2 flex-1 mr-2">${task.title}</h4>
                                ${task.priority === 'high' ? '<svg class="w-4 h-4 text-red-500 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M3 6a3 3 0 013-3h10a1 1 0 01.8 1.6L14.25 8l2.55 3.4A1 1 0 0116 13H6a1 1 0 00-1 1v3a1 1 0 11-2 0V6z" clip-rule="evenodd"></path></svg>' : ''}
                            </div>
                            ${task.description ? `<p class="text-xs text-gray-500 dark:text-gray-400 mb-3 line-clamp-2">${task.description}</p>` : ''}
                            <div class="flex items-center justify-between">
                                <div class="flex gap-1">
                                    ${task.tags.slice(0, 2).map(tag => `<span class="text-[10px] bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 px-1.5 py-0.5 rounded">${tag}</span>`).join('')}
                                    ${task.tags.length > 2 ? `<span class="text-[10px] text-gray-400">+${task.tags.length - 2}</span>` : ''}
                                </div>
                                <div class="flex -space-x-2">
                                    <div class="w-6 h-6 rounded-full bg-gradient-to-br from-blue-400 to-blue-600 border-2 border-white dark:border-gray-800 flex items-center justify-center text-[10px] text-white font-medium">
                                        ${task.title.charAt(0).toUpperCase()}
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }
            };

            // Public API
            return {
                init() {
                    StorageService.init();
                    if (state.darkMode) {
                        document.documentElement.classList.add('dark');
                        document.getElementById('theme-text').textContent = 'Light Mode';
                    }
                    render.boardsList();
                    if (state.currentBoardId) {
                        render.boardView();
                    } else {
                        elements.contentArea.innerHTML = '<div class="flex items-center justify-center h-full text-gray-500 dark:text-gray-400">Select or create a board to get started</div>';
                    }
                },

                // Board Management
                selectBoard(boardId) {
                    state.currentBoardId = boardId;
                    render.boardsList();
                    if (state.currentView === 'board') {
                        render.boardView();
                    } else {
                        render.listView();
                    }
                    if (window.innerWidth < 768) {
                        this.toggleSidebar();
                    }
                },

                openBoardModal() {
                    elements.boardModal.classList.remove('hidden');
                    setTimeout(() => {
                        elements.boardModalContent.classList.remove('scale-95', 'opacity-0');
                        elements.boardModalContent.classList.add('scale-100', 'opacity-100');
                    }, 10);
                    document.getElementById('board-name').focus();
                },

                closeBoardModal() {
                    elements.boardModalContent.classList.remove('scale-100', 'opacity-100');
                    elements.boardModalContent.classList.add('scale-95', 'opacity-0');
                    setTimeout(() => {
                        elements.boardModal.classList.add('hidden');
                        document.getElementById('board-name').value = '';
                        document.getElementById('board-desc').value = '';
                    }, 200);
                },

                handleBoardSubmit(e) {
                    e.preventDefault();
                    const name = document.getElementById('board-name').value;
                    const desc = document.getElementById('board-desc').value;
                    
                    const newBoard = {
                        id: `board-${utils.generateId()}`,
                        name,
                        description: desc,
                        createdAt: new Date().toISOString(),
                        tasks: []
                    };
                    
                    state.boards.push(newBoard);
                    state.currentBoardId = newBoard.id;
                    StorageService.save(state);
                    
                    render.boardsList();
                    render.boardView();
                    this.closeBoardModal();
                    utils.showToast('Board created successfully');
                },

                deleteBoard(boardId) {
                    if (!confirm('Are you sure you want to delete this board?')) return;
                    state.boards = state.boards.filter(b => b.id !== boardId);
                    if (state.currentBoardId === boardId) {
                        state.currentBoardId = state.boards[0]?.id || null;
                    }
                    StorageService.save(state);
                    render.boardsList();
                    if (state.currentBoardId) {
                        render.boardView();
                    } else {
                        elements.contentArea.innerHTML = '<div class="flex items-center justify-center h-full text-gray-500 dark:text-gray-400">Select or create a board to get started</div>';
                        elements.currentBoardName.textContent = 'Select a Board';
                    }
                    utils.showToast('Board deleted');
                },

                // Task Management
                openTaskModal(taskId = null, defaultStatus = 'todo') {
                    const modal = elements.taskModal;
                    const content = elements.taskModalContent;
                    const form = document.getElementById('task-form');
                    const deleteBtn = document.getElementById('delete-task-btn');
                    const title = document.getElementById('modal-title');
                    
                    modal.classList.remove('hidden');
                    setTimeout(() => {
                        content.classList.remove('scale-95', 'opacity-0');
                        content.classList.add('scale-100', 'opacity-100');
                    }, 10);
                    
                    if (taskId) {
                        const board = state.boards.find(b => b.id === state.currentBoardId);
                        const task = board.tasks.find(t => t.id === taskId);
                        document.getElementById('task-id').value = task.id;
                        document.getElementById('task-title').value = task.title;
                        document.getElementById('task-desc').value = task.description || '';
                        document.getElementById('task-priority').value = task.priority;
                        document.getElementById('task-status').value = task.status;
                        document.getElementById('task-tags').value = task.tags.join(', ');
                        deleteBtn.classList.remove('hidden');
                        title.textContent = 'Edit Task';
                    } else {
                        form.reset();
                        document.getElementById('task-id').value = '';
                        document.getElementById('task-status').value = defaultStatus;
                        deleteBtn.classList.add('hidden');
                        title.textContent = 'New Task';
                    }
                    
                    document.getElementById('task-title').focus();
                },

                closeTaskModal() {
                    elements.taskModalContent.classList.remove('scale-100', 'opacity-100');
                    elements.taskModalContent.classList.add('scale-95', 'opacity-0');
                    setTimeout(() => {
                        elements.taskModal.classList.add('hidden');
                    }, 200);
                },

                handleTaskSubmit(e) {
                    e.preventDefault();
                    const taskId = document.getElementById('task-id').value;
                    const board = state.boards.find(b => b.id === state.currentBoardId);
                    
                    const taskData = {
                        title: document.getElementById('task-title').value,
                        description: document.getElementById('task-desc').value,
                        priority: document.getElementById('task-priority').value,
                        status: document.getElementById('task-status').value,
                        tags: document.getElementById('task-tags').value.split(',').map(t => t.trim()).filter(t => t)
                    };
                    
                    if (taskId) {
                        const index = board.tasks.findIndex(t => t.id === taskId);
                        board.tasks[index] = { ...board.tasks[index], ...taskData };
                        utils.showToast('Task updated');
                    } else {
                        const newTask = {
                            id: `task-${utils.generateId()}`,
                            ...taskData,
                            createdAt: new Date().toISOString()
                        };
                        board.tasks.push(newTask);
                        utils.showToast('Task created');
                    }
                    
                    StorageService.save(state);
                    if (state.currentView === 'board') {
                        render.boardView();
                    } else {
                        render.listView();
                    }
                    this.closeTaskModal();
                },

                deleteCurrentTask() {
                    const taskId = document.getElementById('task-id').value;
                    this.deleteTask(taskId);
                    this.closeTaskModal();
                },

                deleteTask(taskId) {
                    if (!confirm('Delete this task?')) return;
                    const board = state.boards.find(b => b.id === state.currentBoardId);
                    board.tasks = board.tasks.filter(t => t.id !== taskId);
                    StorageService.save(state);
                    if (state.currentView === 'board') {
                        render.boardView();
                    } else {
                        render.listView();
                    }
                    utils.showToast('Task deleted');
                },

                // Drag and Drop
                handleDragStart(e, taskId) {
                    state.draggedTask = taskId;
                    e.target.classList.add('dragging');
                    e.dataTransfer.effectAllowed = 'move';
                },

                handleDragEnd(e) {
                    e.target.classList.remove('dragging');
                    state.draggedTask = null;
                    document.querySelectorAll('.column-drop-zone').forEach(zone => {
                        zone.classList.remove('drag-over');
                    });
                },

                handleDragOver(e) {
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'move';
                    const zone = e.currentTarget;
                    zone.classList.add('drag-over');
                },

                handleDragLeave(e) {
                    if (e.currentTarget === e.target) {
                        e.currentTarget.classList.remove('drag-over');
                    }
                },

                handleDrop(e) {
                    e.preventDefault();
                    const zone = e.currentTarget;
                    zone.classList.remove('drag-over');
                    
                    if (!state.draggedTask) return;
                    
                    const newStatus = zone.dataset.status;
                    const board = state.boards.find(b => b.id === state.currentBoardId);
                    const task = board.tasks.find(t => t.id === state.draggedTask);
                    
                    if (task && task.status !== newStatus) {
                        task.status = newStatus;
                        StorageService.save(state);
                        render.boardView();
                        utils.showToast(`Moved to ${newStatus.replace(/([A-Z])/g, ' $1').trim()}`);
                    }
                },

                // View Management
                switchView(view) {
                    state.currentView = view;
                    elements.viewBoardBtn.className = view === 'board' 
                        ? 'px-3 py-1.5 rounded-md text-sm font-medium transition-all bg-white dark:bg-gray-700 shadow-sm' 
                        : 'px-3 py-1.5 rounded-md text-sm font-medium transition-all text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white';
                    elements.viewListBtn.className = view === 'list' 
                        ? 'px-3 py-1.5 rounded-md text-sm font-medium transition-all bg-white dark:bg-gray-700 shadow-sm' 
                        : 'px-3 py-1.5 rounded-md text-sm font-medium transition-all text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white';
                    
                    if (state.currentBoardId) {
                        if (view === 'board') {
                            render.boardView();
                        } else {
                            render.listView();
                        }
                    }
                },

                // UI Utilities
                toggleSidebar() {
                    elements.sidebar.classList.toggle('-translate-x-full');
                    elements.sidebarOverlay.classList.toggle('hidden');
                },

                toggleTheme() {
                    state.darkMode = !state.darkMode;
                    document.documentElement.classList.toggle('dark');
                    document.getElementById('theme-text').textContent = state.darkMode ? 'Light Mode' : 'Dark Mode';
                    StorageService.save(state);
                }
            };
        })();

        // Initialize App
        const app = KanbanApp;
        document.addEventListener('DOMContentLoaded', () => {
            app.init();
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                app.closeTaskModal();
                app.closeBoardModal();
            }
            if (e.ctrlKey && e.key === 'n') {
                e.preventDefault();
                app.openTaskModal();
            }
        });
    </script>
</body>
</html>
